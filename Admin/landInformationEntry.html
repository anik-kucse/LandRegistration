<!doctype html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link href="../Assets/bootstrap.min.css" rel="stylesheet">
        <!-- <link href="../assets/floatingLabel.css" rel="stylesheet"> -->
        <title>LandRegistry</title>
    </head> 
    <body>
        <nav class="navbar navbar-expand-lg navbar-light bg-light fixed-top">
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarTogglerDemo03" aria-controls="navbarTogglerDemo03" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <a class="navbar-brand" href="http://localhost/landRegistry/Admin/home.html">LandRegistry</a>
    
            <div class="collapse navbar-collapse" id="navbarTogglerDemo03">
                <ul class="navbar-nav mr-auto mt-2 mt-lg-0">
                    <li class="nav-item active">
                    <a class="nav-link" href="http://localhost/landRegistry/Admin/home.html">Home</a>
                    </li>
                    <li class="nav-item">
                    <a class="nav-link" href="http://localhost/landRegistry/Admin/landInformationEntry.html">Information Entry</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="http://localhost/landRegistry/Admin/searchInformation.html">Search Information</a>
                    </li>
                </ul>
            </div>
        </nav>
        <div class="container" style="margin-top: 55px">
            <div class="" >
                <h1 class="text-center">Land Information Entry</h1>
                
                <div class="form-label-group">
                    <select class="custom-select" id="select_creation_type" required autofocus>
                        <option value="1">Create A New Title</option>
                        <option value="2">Create From an Existing Title</option>
                    </select>
                </div>
                <div class="new_title">
                    <div class="form-label-group">
                        <input type="number" id="_serialNo" class="form-control" placeholder="Serial Number" required>
                        <label for="_serialNo">Serial Number</label>
                    </div>
                    <div class="form-label-group">
                        <input type="number" id="_bookNo" class="form-control" placeholder="Book Number">
                        <label for="_bookNo">Book Number</label>
                    </div>
                    <div class="form-label-group">
                        <input type="number" id="_titleNo" class="form-control" placeholder="Title Number ">
                        <label for="_titleNo">Title Number</label>
                    </div>
                    <div class="form-label-group">
                        <select class="custom-select" id="_titleType">
                            <option selected value="0">Select Land Type</option>
                            <option value="1">Housing</option>
                            <option value="2">Farming</option>
                            <option value="3">Potit</option>
                        </select>
                    </div>
                    <div class="form-label-group">
                        <input type="number" id="_titleArea" class="form-control" placeholder="Title Area">
                        <label for="_titleArea">Title Area (square meter)</label>
                    </div>
                    <div class="form-label-group">
                        <input type="text" id="_officeAddress" class="form-control" placeholder="Office Address">
                        <label for="_officeAddress">Office Address</label>
                    </div>
                    <div class="form-label-group">
                        <input type="text" id="_moujaNo" class="form-control" placeholder="Mouja Number">
                        <label for="_moujaNo">Mouja Number</label>
                    </div>
                    <div class="form-label-group">
                        <input type="text" id="_lineNo" class="form-control" placeholder="Line Number">
                        <label for="_lineNo">Line Number</label>
                    </div>
                    <div class="form-label-group">
                        <input type="text" id="_buyer" class="form-control" placeholder="Owner Address">
                        <label for="_buyer">Owner Address</label>
                    </div>
                </div>
                <div class="old_title">
                    <div class="form-label-group">
                        <input type="text" id="_seller" class="form-control" placeholder="Seller Address">
                        <label for="_seller">Seller Address</label>
                    </div>
                    <div class="form-label-group">
                        <input type="number" id="_percentOwn" class="form-control" placeholder="How much in selling">
                        <label for="_percentOwn">How much in selling</label>
                    </div>
                    <div class="form-label-group">
                        <input type="text" id="_buyFormTitleHash" class="form-control" placeholder="Hash of Seller's Title">
                        <label for="_buyFormTitleHash">Hash of Seller's Title</label>
                    </div>
                </div>
                <button class="btn btn-lg btn-primary btn-block" id="btnCreate" >Create</button>
                <br>
                <div class="alert alert-success">
                    <strong>Success!</strong> Indicates a successful or positive action.
                </div>
                <div class="alert alert-danger">
                    <strong>Danger!</strong> Indicates a dangerous or potentially negative action.
                </div>
                <p id="msg"></p>
            </div>
        </div>

        <script src="../Assets/jquery.min.js"></script>
        <script src="../Assets/popper.min.js"></script>
        <script src="../Assets/bootstrap.min.js"></script>
        <script src="../Assets/web3.min.js"></script>
        <script src="../Assets/ethers-v4.min.js"></script>

        <script>
            
            if (typeof web3 !== 'undefined') {
                web3 = new Web3(web3.currentProvider);
            } else {
                // set the provider you want from Web3.providers
                // web3 = new Web3(new Web3.providers.HttpProvider("https://rinkeby.infura.io/v3/8cc5ad5dd4754880896babcc1e5bcc4f"));
                web3 = new Web3(new Web3.providers.HttpProvider("http://localhost:7545"));
            }
            // console.log(web3.fromAscii("1254amihd"))
            var accountAddress =  web3.eth.defaultAccount = web3.eth.accounts[0];
            var LandContract = web3.eth.contract([{"constant":true,"inputs":[{"name":"id","type":"uint256"}],"name":"getTitleHashById","outputs":[{"name":"titleHash","type":"bytes32"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"titleHash","type":"bytes32"}],"name":"getTitleMappingByTitilehash","outputs":[{"name":"serialNo","type":"uint16"},{"name":"bookNo","type":"uint16"},{"name":"titleNo","type":"uint16"},{"name":"titleType","type":"uint8"},{"name":"titleArea","type":"uint16"},{"name":"percentOwn","type":"uint8"},{"name":"officeAddress","type":"string"},{"name":"moujaNo","type":"bytes32"},{"name":"lineNo","type":"bytes32"},{"name":"seller","type":"address"},{"name":"buyer","type":"address"},{"name":"buyFormTitleHash","type":"bytes32"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"getTitleArrayLength","outputs":[{"name":"count","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"_serialNo","type":"uint16"},{"name":"_bookNo","type":"uint16"},{"name":"_titleNo","type":"uint16"},{"name":"_titleType","type":"uint8"},{"name":"_titleArea","type":"uint16"},{"name":"_officeAddress","type":"string"},{"name":"_moujaNo","type":"bytes32"},{"name":"_lineNo","type":"bytes32"},{"name":"_buyer","type":"address"}],"name":"creatNewTitle","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"_serialNo","type":"uint16"},{"name":"_bookNo","type":"uint16"},{"name":"_titleNo","type":"uint16"},{"name":"_titleType","type":"uint8"},{"name":"_titleArea","type":"uint16"},{"name":"_percentOwn","type":"uint8"},{"name":"_officeAddress","type":"string"},{"name":"_moujaNo","type":"bytes32"},{"name":"_lineNo","type":"bytes32"},{"name":"_seller","type":"address"},{"name":"_buyer","type":"address"},{"name":"_buyFormTitleHash","type":"bytes32"}],"name":"creatNewTitleFormExistingOne","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"name":"","type":"bytes32"}],"name":"titleMapping","outputs":[{"name":"serialNo","type":"uint16"},{"name":"bookNo","type":"uint16"},{"name":"titleNo","type":"uint16"},{"name":"titleType","type":"uint8"},{"name":"titleArea","type":"uint16"},{"name":"percentOwn","type":"uint8"},{"name":"isExist","type":"bool"},{"name":"officeAddress","type":"string"},{"name":"moujaNo","type":"bytes32"},{"name":"lineNo","type":"bytes32"},{"name":"seller","type":"address"},{"name":"buyer","type":"address"},{"name":"buyFormTitleHash","type":"bytes32"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"contarctOwner","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"","type":"uint256"}],"name":"titleArray","outputs":[{"name":"","type":"bytes32"}],"payable":false,"stateMutability":"view","type":"function"},{"inputs":[],"payable":false,"stateMutability":"nonpayable","type":"constructor"},{"anonymous":false,"inputs":[{"indexed":false,"name":"titleHash","type":"bytes32"}],"name":"creationOftitle","type":"event"}]);
            var contract = LandContract.at('0x9f9649647f6f4f699adc958b884e3b6492c046bd');

            var selection_type  = $("#select_creation_type").val();
            if (selection_type == 1){
                $(".old_title").hide();
            }
            
            var success = $(".alert-success");
            var fail = $(".alert-danger");
            success.hide();
            fail.hide();
            
            $('#select_creation_type').change(function(){
                var selection_type1  = $("#select_creation_type").val();
                console.log(selection_type1)
                if (selection_type1 == 1){
                    $(".old_title").hide();
                }else if(selection_type1 == 2){
                    $(".old_title").show();
                }
            });

            var creationOftitleEvent = contract.creationOftitle();
            creationOftitleEvent.watch(function(error, result){
                if (!error)
                    {
                        $("#msg").html(result.args.titleHash);
                    } else {
                        console.log(error);
                    }
            });

            $("#btnCreate").click(function(){
                var serialNo = $("#_serialNo").val();
                var bookNo = $("#_bookNo").val();
                var titleNo =$("#_titleNo").val();
                var titleType  = $("#_titleType").val();
                var titleArea = $("#_titleArea").val();
                var officeAddress = $("#_officeAddress").val();
                var moujaNo = web3.fromAscii($("#_moujaNo").val());
                var lineNo = web3.fromAscii($("#_lineNo").val());
                var buyer = $("#_buyer").val();
                if($("#select_creation_type").val() == 1 && serialNo != '' && bookNo != '' && titleNo != '' &&
                    titleType != '' && titleArea != '' &&  officeAddress != '' && moujaNo != '' &&
                    lineNo != '' && buyer != '' ){
                    contract.creatNewTitle(serialNo, bookNo, titleNo, titleType, titleArea, officeAddress, moujaNo, lineNo, buyer,(err, res)=>{
                        if(err){
                            fail.show();
                            success.hide();
                        }else{
                            fail.hide();
                            success.show();
                        }
                    });
                }else if($("#select_creation_type").val() == 2 && serialNo != '' && bookNo != '' && titleNo != '' &&
                    titleType != '' && titleArea != '' && percentOwn != '' &&  officeAddress != '' && moujaNo != '' &&
                    lineNo != '' && seller != '' && buyer != '' && buyFormTitleHash != ''){
                    var seller = $("#_seller").val();
                    var percentOwn = $("#_percentOwn").val();
                    var buyFormTitleHash = $("#_buyFormTitleHash").val();
                    contract.creatNewTitleFormExistingOne(serialNo, bookNo, titleNo, titleType, titleArea, percentOwn, officeAddress, moujaNo, lineNo, seller, buyer, buyFormTitleHash,(err, res)=>{
                        if(err){
                            fail.show();
                            success.hide();
                        }else{
                            fail.hide();
                            success.show();
                        }
                    });
                }
                else{
                    console.log("errrasdasdasdrrr");
                }
            });
            
        </script>
    </body>   
</html>